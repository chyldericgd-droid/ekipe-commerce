  <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ekipe 6.1 Commerce - Catalogue</title>
ß
    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzWnBWAigG8ZdyvbnwzxD9NgXy23Yl0Csy5d_xW2QtUDBAEbFxKLbeCwEgylH_an-wZ/exec'; 
    </script>
    
    <style>
        /* Variables de couleurs minimalistes et fiables */
        :root {
            --primary-color: #007aff; /* Bleu Apple */
            --accent-color: #34c759;  /* Vert de validation */
            --background-color: #f0f2f5; 
            --card-bg: rgba(255, 255, 255, 0.7); /* Fond légèrement transparent */
            --text-dark: #1d1d1f; 
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif; 
            background-color: var(--background-color);
            color: var(--text-dark);
            margin: 0;
            line-height: 1.6;
        }
        
        /* Styles de la Navigation */
        .nav-bar {
            display: flex;
            justify-content: center;
            background-color: var(--card-bg); 
            backdrop-filter: blur(8px);
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
            transition: opacity 0.3s, visibility 0.3s, height 0.3s, padding 0.3s; 
        }
        .nav-link {
            color: var(--text-dark);
            padding: 10px 25px;
            margin: 0 10px;
            text-decoration: none;
            font-weight: 500;
            border-radius: 8px;
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
        }
        .nav-link:hover {
            background-color: rgba(0, 122, 255, 0.1); 
        }
        .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Conteneurs et Formulaires */
        #content { padding: 40px 20px; }
        .page-title { text-align: center; margin-bottom: 30px; font-weight: 700; font-size: 2em; }
        .product-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: var(--shadow-light);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .product-card:hover { transform: translateY(-5px); }
        .product-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; }
        .product-image-placeholder img { width: 100%; display: block; }
        .form-container {
            max-width: 650px;
            margin: 0 auto;
            padding: 30px;
            border-radius: 15px;
            background: var(--card-bg); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        }
        /* Styles pour inputs/selects et boutons */
        label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: 600; color: var(--text-dark); }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 10px 12px; margin-bottom: 10px; box-sizing: border-box; border-radius: 8px; font-size: 16px; font-family: inherit;
            background-color: rgba(255, 255, 255, 0.8); border: 1px solid #d1d1d6; transition: border-color 0.2s, box-shadow 0.2s;
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2); background-color: white; }
        button {
            background-color: var(--primary-color); color: white; font-size: 1.1em; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer;
            width: 100%; margin-top: 20px; transition: background-color 0.2s, transform 0.1s;
        }
        button:hover { background-color: #005bb5; transform: translateY(-1px); }
        .price-box {
            background-color: #e6f7ff; color: var(--primary-color); border-left: 5px solid var(--primary-color); padding: 15px; margin-top: 20px; border-radius: 8px; font-weight: 700;
        }
        .response-success { border-color: var(--accent-color); color: var(--accent-color); padding: 10px; margin-top: 20px; border-radius: 8px; background-color: #e8f9ed; border: 1px solid; text-align: center;}
        .response-error { border-color: #ff3b30; color: #ff3b30; padding: 10px; margin-top: 20px; border-radius: 8px; background-color: #ffe6e6; border: 1px solid; text-align: center;}
    </style>
</head>
<body>
    
    <div class="nav-bar">
        <a href="#catalogue" class="nav-link active" onclick="loadPage('Catalogue')">Catalogue</a>
        <a href="#personnalisation" class="nav-link" onclick="loadPage('Personnalisation')">Personnalisation</a>
        <a href="#collaboration" class="nav-link" onclick="loadPage('Collaboration')">Collaboration Artiste</a>
    </div>

    <div id="content">
        </div>
    
    <script>
        
        // --- 1. FONCTIONS DE RENDU HTML ---
        
        function getCatalogueHTML() {
            return `
                <div class="page-title">Nos Designs Exclusifs</div>
                <p style="text-align: center; margin-bottom: 40px;">Sélectionnez un design pour configurer votre commande.</p>

                <div class="product-grid">

                    <div class="product-card" onclick="showDetailsPage('T-Shirt Classique', 'TS-CL001')">
                        <div class="product-image-placeholder">
                            <img src="https://via.placeholder.com/280x200?text=Design+Classique" alt="T-Shirt Classique">
                        </div>
                        <div class="product-info">
                            <h3>T-Shirt Classique</h3>
                            <p>Le pilier de notre collection. Simplicité et élégance.</p>
                        </div>
                    </div>

                    <div class="product-card" onclick="showDetailsPage('T-Shirt Géométrique', 'TS-GE002')">
                        <div class="product-image-placeholder">
                            <img src="https://via.placeholder.com/280x200?text=Design+Geometrique" alt="T-Shirt Géométrique">
                        </div>
                        <div class="product-info">
                            <h3>T-Shirt Géométrique</h3>
                            <p>Motifs audacieux et structurés.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDetailsHTML() {
            return `
                <div class="form-container">
                    <div id="details-title-container"><h2>VOTRE CHOIX</h2></div>
                    <form id="commande-form" onsubmit="event.preventDefault(); submitForm()">
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <img id="design-image" src="" alt="Design sélectionné" style="width: 250px; height: 180px; object-fit: cover; border-radius: 5px;">
                            <p style="color: var(--primary-color);" id="design-name-display"></p>
                            <input type="hidden" id="selected-design-id" name="design_id">
                        </div>
                        
                        <div class="form-section">
                            <h3>1. Configuration de l'Article</h3>
                            
                            <label for="quantite">QUANTITÉ DÉSIRÉE *</label>
                            <input type="number" id="quantite" name="quantite" min="1" value="1" required>

                            <label for="qualite">QUALITÉ DE T-SHIRT (Définit le prix) *</label>
                            <select id="qualite" name="qualite" required>
                                <option value="T-Shirt Simple">Niveau Standard (T-Shirt Simple)</option>
                                <option value="T-Shirt Pro">Niveau Pro (T-Shirt Pro)</option>
                                <option value="T-Shirt Max">Niveau Max (T-Shirt Max)</option>
                            </select>

                            <label for="fabrication">OPTION DE FABRICATION & LIVRAISON *</label>
                            <select id="fabrication" name="fabrication" required>
                                <option value="Standard">Standard (Délai normal, 1500F + Livraison)</option>
                                <option value="Premium">Premium (Délai optimisé, 2000F + Livraison)</option>
                            </select>
                            
                            <input type="hidden" id="designe" name="designe" value="Boutique"> 
                            <p style="color: #666; font-size: 0.9em;">Type de Commande : Client Standard (Catalogue)</p>
                            
                            <div id="prix-calcule" class="price-box">Prix de Vente Calculé : 0 FCFA</div>
                        </div>
                        
                        <div class="form-section">
                            <h3>2. FINALISATION & TRANSFERT</h3>
                            
                            <p>Effectuez le paiement Mobile Money **AVANT** de saisir la référence :</p>
                            <p style="font-weight: bold; color: var(--accent-color); text-align: center;">
                                MTN : 064131363 | AIRTEL : 056067092
                            </p>
                            
                            <label for="reference">ID DE TRANSACTION (Référence Paiement) *</label>
                            <input type="text" id="reference" name="reference" placeholder="Format de votre ID" required>
                            
                            <label for="nom_client">NOM COMPLET *</label>
                            <input type="text" id="nom_client" name="nom_client" required>

                            <label for="ville">ADRESSE DE LIVRAISON *</label>
                            <input type="text" id="ville" name="ville" required>
                            
                            <label for="operateur">OPÉRATEUR MOBILE MONEY *</label>
                            <select id="operateur" name="operateur">
                                <option value="MTN Money">MTN Money</option>
                                <option value="Airtel Money">Airtel Money</option>
                                <option value="Moov Money">Moov Money</option>
                                <option value="Autre">Autre</option>
                            </select>
                            
                            <p style="margin-top: 15px; border-left: 3px solid var(--accent-color); padding-left: 10px; font-size: 0.9em;">
                                *Si vous choisissez **"Retrait KM4"** comme adresse, les frais de livraison seront annulés.
                            </p>
                        </div>
                        
                        <button type="submit">CONFIRMER & VALIDER LE PAIEMENT</button>
                    </form>

                    <div id="reponse-serveur" class="response-success" style="display: none;"></div>
                </div>
            `;
        }

        function getEmptyPageHTML(title) {
            return `<div class="page-title">${title}</div><p style="text-align: center;">Cette section est en cours de construction. Revenez bientôt !</p>`;
        }
        
        // --- 2. LOGIQUE DE NAVIGATION ---
        
        function loadPage(pageName) {
            const contentDiv = document.getElementById('content');
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach(l => l.classList.remove('active'));
            document.querySelector(`.nav-link[onclick*='${pageName}']`).classList.add('active');

            if (pageName === 'Catalogue') {
                contentDiv.innerHTML = getCatalogueHTML();
            } else if (pageName === 'Details') {
                // Fait par showDetailsPage()
            } else if (pageName === 'Personnalisation') {
                contentDiv.innerHTML = getEmptyPageHTML('Personnalisation de T-Shirt');
            } else if (pageName === 'Collaboration') {
                contentDiv.innerHTML = getEmptyPageHTML('Collaboration Artiste');
            }
        }
        
        function showDetailsPage(productName, designId) {
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = getDetailsHTML(); 
            
            // Mise à jour des informations spécifiques
            document.getElementById('design-name-display').textContent = productName; 
            document.getElementById('selected-design-id').value = designId;
            document.getElementById('design-image').src = `https://via.placeholder.com/250x180?text=${designId}`;
            
            // Initialise les écouteurs pour les appels API
            setupPriceCalculations();
            calculatePrice(); 
        }

        function setupPriceCalculations() {
            const form = document.getElementById('commande-form');
            if (form) {
                // Le calcul doit se faire à chaque changement ou saisie
                form.quantite.addEventListener('input', calculatePrice);
                form.qualite.addEventListener('change', calculatePrice);
                form.fabrication.addEventListener('change', calculatePrice);
                form.ville.addEventListener('input', calculatePrice); 
            }
        }

        // --- 3. LOGIQUE D'APPEL API (Fetch) ---

        /**
         * Appelle l'API Apps Script pour calculer le prix.
         */
        function calculatePrice() {
            const form = document.getElementById('commande-form');
            if (!form || !API_URL) return;
            
            const quantite = form.quantite.value;
            const designe = form.designe.value; 
            const qualite = form.qualite.value;
            const fabrication = form.fabrication.value;
            const adresse = form.ville.value; 

            // Construction de l'URL pour la requête GET
            const url = new URL(API_URL);
            url.searchParams.append('action', 'calculatePrice');
            url.searchParams.append('quantite', quantite);
            url.searchParams.append('designe', designe);
            url.searchParams.append('qualite', qualite);
            url.searchParams.append('fabrication', fabrication);
            url.searchParams.append('adresse', adresse);

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const priceDiv = document.getElementById('prix-calcule');
                    if (data.status === 'success') {
                        priceDiv.textContent = "Prix de Vente Calculé : " + data.price;
                    } else {
                        priceDiv.textContent = "Erreur de calcul : " + (data.message || "API non fonctionnelle.");
                        console.error("API Error:", data.message);
                    }
                })
                .catch(error => {
                    document.getElementById('prix-calcule').textContent = "Erreur de connexion API.";
                    console.error('Fetch Error:', error);
                });
        }
        
        /**
         * Appelle l'API Apps Script pour soumettre le formulaire (POST).
         */
        function submitForm() {
            const form = document.getElementById('commande-form');
            const responseDiv = document.getElementById('reponse-serveur');
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Collecte des données à envoyer
            const dataToSend = {
                quantite: form.quantite.value,
                designe: form.designe.value, 
                qualite: form.qualite.value,
                fabrication: form.fabrication.value,
                reference: form.reference.value,
                nom_client: form.nom_client.value,
                ville: form.ville.value, 
                operateur: form.operateur.value,
                produit_selectionne: document.getElementById('selected-design-id').value 
            };

            responseDiv.style.display = 'block';
            responseDiv.className = 'response-success';
            responseDiv.textContent = "Enregistrement en cours via API, veuillez patienter...";

            fetch(API_URL, {
                method: 'POST',
                mode: 'cors', 
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dataToSend)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    responseDiv.className = 'response-success';
                    responseDiv.textContent = data.message;
                    form.reset();
                    document.getElementById('prix-calcule').textContent = "Prix de Vente Calculé : 0 FCFA";
                    
                    setTimeout(() => {
                        responseDiv.style.display = 'none';
                        loadPage('Catalogue'); 
                    }, 3000); 

                } else {
                    responseDiv.className = 'response-error';
                    responseDiv.textContent = "❌ Erreur d'enregistrement : " + data.message;
                }
            })
            .catch(error => {
                responseDiv.className = 'response-error';
                responseDiv.textContent = "❌ Erreur de connexion au serveur.";
                console.error('Submit Fetch Error:', error);
            });
        }
        
        // --- DÉMARRAGE ---
        document.addEventListener('DOMContentLoaded', function() {
            loadPage('Catalogue'); 
        });
    </script>
</body>
</html>